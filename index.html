<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Study Log & Flashcards</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
<style>
body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
#sidebar { width: 200px; background: #f0f0f0; padding: 20px; overflow-y: auto; }
#content { flex: 1; padding: 20px; overflow-y: auto; position: relative; scroll-behavior: smooth; }

.folder-title { cursor: pointer; margin-bottom: 8px; font-weight: bold; }
.folder-content { display: none; margin-left: 15px; }
.folder.open .folder-content { display: block; }

.file-item { cursor: pointer; padding: 5px; border-radius: 4px; margin-bottom: 3px; transition: background 0.2s, font-weight 0.2s; }
.file-item:hover { background: white; font-weight: bold; }

#self-study-btn {
  position: fixed;
  top: 10px;
  right: 10px;
  background: #222;
  color: white;
  border: 1px solid #555;
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  z-index: 1000;
}

#self-study-page {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.95);
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
  z-index: 999;
}

.status-square {
  display: inline-block;
  width: 15px;
  height: 15px;
  margin-right: 8px;
  vertical-align: middle;
}
</style>
</head>
<body>

<div id="sidebar"></div>
<div id="content"></div>
<button id="self-study-btn">Self-Study Stats</button>

<div id="self-study-page">
  <h1 id="ss-day-count" style="font-size:50px;margin-bottom:30px;"></h1>
  <div id="ss-total-cards" style="font-size:40px;margin-bottom:40px;"></div>
  <div id="ss-plans" style="font-size:20px;"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const sidebar = document.getElementById("sidebar");
  const content = document.getElementById("content");
  const selfStudyBtn = document.getElementById("self-study-btn");
  const selfStudyPage = document.getElementById("self-study-page");

  const studyData = await fetch("study_log.json").then(r => r.json());

  // Build Study Log folder (single long page)
  const studyFolder = document.createElement("div");
  studyFolder.classList.add("folder");
  studyFolder.innerHTML = `<div class="folder-title">Study Log</div>`;
  const studyList = document.createElement("div");
  studyList.classList.add("folder-content");

  studyData.forEach(entry => {
    const div = document.createElement("div");
    div.textContent = `Day ${entry.day} — ${entry.date}`;
    div.classList.add("file-item");
    div.addEventListener("click", () => scrollToDay(entry.day));
    studyList.appendChild(div);
  });
  studyFolder.appendChild(studyList);
  sidebar.appendChild(studyFolder);

  // Full study log rendered at once
  const fullContainer = document.createElement("div");
  fullContainer.id = "full-study-log";
  studyData.forEach(entry => {
    const section = document.createElement("section");
    section.id = `day-${entry.day}`;
    section.style.marginBottom = "40px";
    section.innerHTML = `<h2>Day ${entry.day} — ${entry.date}</h2>`;
    const ul = document.createElement("ul");
    entry.topics.forEach(t => {
      const li = document.createElement("li");
      li.textContent = t;
      ul.appendChild(li);
    });
    section.appendChild(ul);
    fullContainer.appendChild(section);
  });
  content.appendChild(fullContainer);

  function scrollToDay(dayNumber) {
    const section = document.getElementById(`day-${dayNumber}`);
    if (section) {
      const rect = section.getBoundingClientRect();
      const offset = rect.top + window.scrollY - (window.innerHeight / 2) + (rect.height / 2);
      window.scrollTo({ top: offset, behavior: "smooth" });
    }
  }

  // Flashcards folder
  const flashFolder = document.createElement("div");
  flashFolder.classList.add("folder");
  flashFolder.innerHTML = `<div class="folder-title">Flashcards</div>`;
  const flashList = document.createElement("div");
  flashList.classList.add("folder-content");

  for (let entry of studyData) {
    const authorMatch = entry.topics.find(t => t.match(/Stewart|Lay|Velleman|Abbott|Friedberg|Resnick/i));
    const author = authorMatch ? authorMatch.match(/(Stewart|Lay|Velleman|Abbott|Friedberg|Resnick)/i)[0] : "Unknown";
    const item = document.createElement("div");
    item.textContent = `Day ${entry.day} (${author})`;
    item.classList.add("file-item");
    item.onclick = () => loadFlashcards(entry.day);
    flashList.appendChild(item);
  }

  flashFolder.appendChild(flashList);
  sidebar.appendChild(flashFolder);

  document.querySelectorAll(".folder-title").forEach(title => {
    title.addEventListener("click", () => {
      title.parentElement.classList.toggle("open");
    });
  });

  async function loadFlashcards(dayNumber) {
    content.innerHTML = `<h2>Day ${dayNumber} Flashcards</h2>`;
    try {
      const txt = await fetch(`flashcards/day${dayNumber}.txt`).then(r => { if (!r.ok) throw 0; return r.text(); });
      const lines = txt.split("\n").filter(l => l.trim() && !l.startsWith("#"));
      if (!lines.length) {
        content.innerHTML += "<p>No flashcards found for this day.</p>";
        return;
      }
      let container = document.createElement("div");
      container.style.display = "flex";
      container.style.flexDirection = "column";
      container.style.gap = "15px";

      lines.forEach((line, i) => {
        const [q, a] = line.split("\t");
        const div = document.createElement("div");
        div.style.border = "1px solid #444";
        div.style.padding = "10px";
        div.style.borderRadius = "8px";
        div.style.cursor = "pointer";
        div.innerHTML = `<b>${i + 1})</b> <span class="question">${q}</span><div class="answer" style="display:none;margin-top:5px;">${a}</div>`;
        div.addEventListener("click", () => {
          const ans = div.querySelector(".answer");
          ans.style.display = ans.style.display === "none" ? "block" : "none";
          renderMathInElement(ans, { delimiters: [{left: "\\[", right: "\\]", display: true}] });
        });
        container.appendChild(div);
      });
      content.appendChild(container);
      renderMathInElement(content, { delimiters: [{left: "\\[", right: "\\]", display: true}] });
    } catch {
      content.innerHTML += "<p>Error loading flashcards.</p>";
    }
  }

  // Self-study stats popup
  selfStudyBtn.addEventListener("click", async () => {
    if (selfStudyPage.style.opacity === "0" || !selfStudyPage.style.opacity) {
      selfStudyPage.style.opacity = "1";
      selfStudyPage.style.pointerEvents = "auto";

      const flashcardDays = [];
      let totalFlashcards = 0;
      for (let dayEntry of studyData) {
        try {
          const txt = await fetch(`flashcards/day${dayEntry.day}.txt`).then(r => { if (!r.ok) throw 0; return r.text(); });
          const lines = txt.split("\n").filter(l => l.trim() && !l.startsWith("#"));
          if (lines.length) {
            flashcardDays.push(dayEntry.day);
            totalFlashcards += lines.length;
          }
        } catch {}
      }

      document.getElementById("ss-day-count").textContent = `Days self-studied: ${flashcardDays.length}`;
      document.getElementById("ss-total-cards").textContent = `Total flashcards: ${totalFlashcards}`;

      const plans = [
        {name: "Stewart's Calculus (Chapters 3–11)", status: "completed"},
        {name: "Lay's Linear Algebra (Chapters 1–6.1)", status: "completed"},
        {name: "Velleman’s Intro to Proofs", status: "ongoing"},
        {name: "Abbott’s Intro to Real Analysis", status: "planned"},
        {name: "Friedberg’s Real Analysis", status: "planned"},
        {name: "Stewart’s Calculus (Chapters 12–16)", status: "planned"},
        {name: "Resnick’s Physics (Chapters 1–20)", status: "planned"},
        {name: "Python (Basics, Numpy, Pandas)", status: "planned"}
      ];

      const ssPlansDiv = document.getElementById("ss-plans");
      ssPlansDiv.innerHTML = "";
      plans.forEach(p => {
        const color = p.status === "completed" ? "green" : p.status === "ongoing" ? "orange" : "red";
        ssPlansDiv.innerHTML += `<div style="margin-bottom:10px;"><span class="status-square" style="background:${color};"></span>${p.name}</div>`;
      });
    } else {
      selfStudyPage.style.opacity = "0";
      selfStudyPage.style.pointerEvents = "none";
    }
  });
});
</script>

</body>
</html>
