<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Study Log & Flashcards</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" 
    onload="renderMathInElement(document.body);"></script>
<style>
body { margin: 0; font-family: sans-serif; display: flex; height: 100vh; }
#sidebar { width: 200px; background: #f0f0f0; padding: 20px; overflow-y: auto; }
#main { flex: 1; padding: 20px; overflow-y: auto; }

.sidebar-folder { cursor: pointer; margin-bottom: 10px; }
.sidebar-folder:hover { font-weight: bold; }
.sidebar-folder .arrow { display: inline-block; width: 12px; transition: transform 0.2s; }
.sidebar-folder .arrow.open { transform: rotate(90deg); }

.sidebar-sub { display: none; margin-left: 15px; margin-bottom: 10px; }
.sidebar-day { cursor: pointer; margin-bottom: 3px; }

.entry { margin-bottom: 30px; border-bottom: 1px solid #ccc; padding-bottom: 10px; }
.flashcard-entry { margin-bottom: 15px; border: 1px solid #aaa; padding: 10px; border-radius: 5px; }
.flashcard-title { cursor: pointer; font-weight: bold; margin-bottom: 5px; }
.flashcard-answer { display: none; margin-left: 15px; margin-bottom: 10px; }
</style>
</head>
<body>

<div id="sidebar">
  <div class="sidebar-folder" data-target="days">
    <span class="arrow">▶</span> Days
    <div class="sidebar-sub" id="days-sub"></div>
  </div>
  <div class="sidebar-folder" data-target="flashcards">
    <span class="arrow">▶</span> Flashcards
    <div class="sidebar-sub" id="flashcards-sub"></div>
  </div>
</div>

<div id="main"></div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const main = document.getElementById("main");

  function scrollToCenter(el) {
    const mainRect = main.getBoundingClientRect();
    const elRect = el.getBoundingClientRect();
    const scrollTop = main.scrollTop;
    const elTop = elRect.top - mainRect.top + scrollTop;
    const scrollTarget = elTop - main.clientHeight / 2 + el.offsetHeight / 2;
    main.scrollTo({ top: scrollTarget, behavior: "smooth" });
  }

  // Collapsible folders
  document.querySelectorAll(".sidebar-folder").forEach(folder => {
    const arrow = folder.querySelector(".arrow");
    const sub = folder.querySelector(".sidebar-sub");

    folder.addEventListener("click", e => {
      if (e.target !== folder) return;
      const isOpen = sub.style.display === "block";
      sub.style.display = isOpen ? "none" : "block";
      arrow.classList.toggle("open", !isOpen);
      if(!isOpen) main.scrollTo({ top: 0, behavior: "smooth" });
    });
  });

  fetch("study_log.json")
    .then(res => res.json())
    .then(studyData => {
      const daysSub = document.getElementById("days-sub");
      const flashcardsSub = document.getElementById("flashcards-sub");

      studyData.forEach(dayEntry => {
        // Main study log entry
        const dayDiv = document.createElement("div");
        dayDiv.className = "entry";
        dayDiv.id = "day-" + dayEntry.day;
        const topicsHtml = dayEntry.topics.map(t => `<li>${t}</li>`).join("");
        dayDiv.innerHTML = `<h2>Day ${dayEntry.day} [${dayEntry.date}]</h2><ul>${topicsHtml}</ul>`;
        main.appendChild(dayDiv);

        // Sidebar day under "Days"
        const sideDay = document.createElement("div");
        sideDay.className = "sidebar-day";
        sideDay.textContent = "Day " + dayEntry.day;
        sideDay.addEventListener("click", () => {
          scrollToCenter(document.getElementById("day-" + dayEntry.day));
        });
        daysSub.appendChild(sideDay);

        // Sidebar day under "Flashcards"
        const sideCard = document.createElement("div");
        sideCard.className = "sidebar-day";
        sideCard.textContent = "Day " + dayEntry.day;
        sideCard.addEventListener("click", async () => {
          const fc = document.getElementById("fc-day-" + dayEntry.day);
          if(fc) scrollToCenter(fc);
        });
        flashcardsSub.appendChild(sideCard);
      });

      // Flashcards header
      const fcHeader = document.createElement("h1");
      fcHeader.textContent = "Flashcards";
      main.appendChild(fcHeader);

      // Load flashcards for each day
      studyData.forEach(dayEntry => {
        const fcDiv = document.createElement("div");
        fcDiv.className = "flashcard-entry";
        fcDiv.id = "fc-day-" + dayEntry.day;
        fcDiv.innerHTML = `<h3>Day ${dayEntry.day} Flashcards</h3>`;
        main.appendChild(fcDiv);

        fetch(`flashcards/day${dayEntry.day}.txt`)
          .then(res => {
            if(!res.ok) throw new Error("File not found");
            return res.text();
          })
          .then(text => {
            const lines = text.split("\n").slice(2); // skip first 2 lines
            lines.forEach(line => {
              if(!line.trim()) return;
              const [title, answer] = line.split("\t");
              const card = document.createElement("div");
              const titleDiv = document.createElement("div");
              titleDiv.className = "flashcard-title";
              titleDiv.textContent = title;
              const answerDiv = document.createElement("div");
              answerDiv.className = "flashcard-answer";
              answerDiv.textContent = answer;
              titleDiv.addEventListener("click", () => {
                answerDiv.style.display = answerDiv.style.display === "block" ? "none" : "block";
                renderMathInElement(answerDiv); // render LaTeX when expanded
              });
              card.appendChild(titleDiv);
              card.appendChild(answerDiv);
              fcDiv.appendChild(card);
            });
          })
          .catch(() => {
            const msg = document.createElement("div");
            msg.textContent = "No flashcards for this day.";
            fcDiv.appendChild(msg);
          });
      });
    })
    .catch(err => console.error("Failed to load study log JSON:", err));
});
</script>

</body>
</html>
